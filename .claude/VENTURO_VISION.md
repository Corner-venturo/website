# Venturo 願景與平台概念

> **版本**: 1.0
> **最後更新**: 2026-01-11
> **必讀對象**: 所有參與 Venturo 開發的 AI 助手與開發者

---

## 核心願景

**Venturo 不只是一套旅遊 App，而是一個完整的旅遊業數位生態系統。**

我們的目標是打造一個「旅行社內部營運」與「旅客外部體驗」完美銜接的平台，讓每一趟旅程從報價、訂購、出發到回憶，都能流暢且精彩。

---

## 雙平台架構

Venturo 由兩個緊密連結的系統組成：

```
┌─────────────────────────────────────────────────────────────────────┐
│                         VENTURO 生態系統                              │
├─────────────────────────────┬───────────────────────────────────────┤
│                             │                                        │
│     venturo-erp             │           venturo-online               │
│     (內部營運)               │           (會員體驗) ⭐ 你在這裡        │
│                             │                                        │
│  ┌─────────────────────┐   │   ┌─────────────────────────────┐     │
│  │ 旅遊團管理          │   │   │ 會員入口                    │     │
│  │ 訂單處理            │   │   │ 行程瀏覽                    │     │
│  │ 客戶關係            │   │   │ 線上報名                    │     │
│  │ 簽證辦理            │   │   │ 付款流程                    │     │
│  │ 財務會計            │   │   │ 旅途日誌                    │     │
│  │ 人資管理            │◄──┼──►│ 照片牆                      │     │
│  │ 供應商管理          │   │   │ 旅遊回憶                    │     │
│  │ 報價/行程設計       │   │   │ 團員互動                    │     │
│  │ 行銷素材            │   │   │ 推薦分享                    │     │
│  └─────────────────────┘   │   └─────────────────────────────┘     │
│                             │                                        │
│       員工專用               │            旅客專用                     │
│                             │                                        │
└─────────────────────────────┴───────────────────────────────────────┘
                              │
                              ▼
                    ┌─────────────────────┐
                    │     Supabase        │
                    │   (共享資料層)       │
                    │                     │
                    │  - 旅遊團資料       │
                    │  - 訂單/會員        │
                    │  - 行程表           │
                    │  - 照片/回憶        │
                    │  - 即時同步         │
                    └─────────────────────┘
```

### 1. venturo-erp（內部營運系統）

**定位**：旅行社員工的日常工作平台

**與 Online 的關係**：
- ERP 是資料的「生產者」
- 旅遊團、行程表、訂單成員等資料在 ERP 產生
- Online 透過資料庫共享讀取這些資料

**主要功能**：
- 旅遊團管理、訂單處理、客戶關係
- 簽證辦理、財務會計、人資管理
- 供應商管理、報價/行程設計

### 2. venturo-online（會員體驗系統）⭐

**定位**：旅客的旅遊入口與回憶平台

**核心功能**：

| 功能模組 | 說明 |
|---------|------|
| **會員入口** | 註冊、登入、個人資料管理 |
| **行程瀏覽** | 查看即將出發的行程詳情 |
| **線上報名** | 選團、填資料、付款 |
| **旅途日誌** | GPS 軌跡、景點打卡記錄 |
| **照片牆** | 團員共享照片、建立相簿 |
| **旅遊回憶** | 行程回顧、精美紀念冊 |
| **團員互動** | 聊天室、群組通知 |
| **分帳功能** | 團員間費用分攤 |
| **推薦分享** | 推薦朋友、分享連結 |

**技術特色**：
- PWA 支援（可安裝到手機桌面）
- 響應式設計（手機優先）
- 離線快取（旅途中無網路時可用）
- 即時通知（Supabase Realtime）
- 效能優化（單例連線、請求去重、快取策略）

---

## 價值飛輪：從營運到體驗的正向循環

```
    ┌──────────────────────────────────────────────────────────────┐
    │                                                              │
    ▼                                                              │
┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐│
│  設計   │───►│  銷售   │───►│  出發   │───►│  回憶   │───►│  推薦   ││
│ 行程    │    │ 報名    │    │ 服務    │    │ 沉澱    │    │ 裂變    ││
└────────┘    └────────┘    └────────┘    └────────┘    └────────┘│
    │              │              │              │              │  │
    │              │              │              │              │  │
    ▼              ▼              ▼              ▼              ▼  │
┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐│
│ ERP    │    │ ERP+   │    │ Online │    │ Online │    │ Online ││
│ 行程表  │    │ Online │    │ 日誌   │    │ 照片牆  │    │ 分享    ││
│ 報價單  │    │ 訂單   │    │ 打卡   │    │ 相簿   │    │ 推薦    ││
└────────┘    └────────┘    └────────┘    └────────┘    └────────┘│
                                                               │  │
                                                               └──┘
                                                          新客戶加入
```

### Online 在飛輪中的角色

| 階段 | Online 的責任 |
|-----|--------------|
| **銷售** | 呈現行程、接收報名、處理付款 |
| **出發** | 行程查看、即時通知、打卡記錄 |
| **回憶** | 照片上傳、相簿生成、回憶沉澱 |
| **推薦** | 分享連結、邀請好友、裂變增長 |

---

## 資料流向

### ERP → Online（營運資料推送）

| ERP 來源 | Online 呈現 |
|---------|------------|
| `tours` (旅遊團) | 我的行程列表 |
| `itineraries` (行程表) | 每日行程詳情 |
| `order_members` (訂單成員) | 團員名單 |
| `attractions` (景點) | 打卡地點選項 |
| 領隊通知 | 即時推播訊息 |

### Online → ERP（體驗資料回流）

| Online 資料 | ERP 用途 |
|------------|---------|
| 會員註冊 | 自動建立客戶資料 |
| 線上報名 | 自動建立訂單 |
| 付款記錄 | 收款對帳 |
| 照片上傳 | 行銷素材庫 |
| 滿意度評價 | 品質改善參考 |

### 雙資料庫架構

Online 連接**兩個** Supabase 資料庫：

```
┌─────────────────────────────────────────────────────────────┐
│                    venturo-online                            │
│                                                              │
│   ┌──────────────────┐         ┌──────────────────┐        │
│   │ Online Supabase  │         │  ERP Supabase    │        │
│   │ (vvtlknlbnbnb...) │         │ (pfqvdacxowpg...) │        │
│   │                  │         │                  │        │
│   │ ✅ 讀寫           │         │ ⚠️ 唯讀          │        │
│   │                  │         │                  │        │
│   │ - 會員資料       │         │ - 旅遊團         │        │
│   │ - 照片/回憶      │◄────────│ - 行程表         │        │
│   │ - 分帳記錄       │  同步    │ - 訂單成員       │        │
│   │ - 聊天訊息       │         │ - 景點資料       │        │
│   └──────────────────┘         └──────────────────┘        │
│           │                             │                   │
│           │                             │                   │
│           ▼                             ▼                   │
│   src/lib/supabase.ts          src/lib/erp-supabase.ts     │
└─────────────────────────────────────────────────────────────┘
```

**重要規則**：
- ✅ Online 資料庫：可讀可寫
- ⚠️ ERP 資料庫：**只能讀取，禁止寫入**

---

## 快取與效能

### 會員登入速度優先

為了確保會員登入速度，採用「寫入時計算」的快取策略：

```sql
-- ERP 更新訂單成員時，自動更新快取表
-- 會員登入時直接讀取快取，避免即時 JOIN
```

### 已實作的效能優化

| 優化項目 | 說明 |
|---------|------|
| Supabase 單例 | API 重用連線，省 200-500ms/請求 |
| 請求去重 | `dedup()` 防止重複請求 |
| 平行查詢 | `Promise.all` 同時執行獨立查詢 |
| API 快取 | `Cache-Control` 標頭減少重複請求 |
| 圖片優化 | Blur placeholder 改善載入體驗 |

---

## 開發協作規範

### 與 ERP 的協作

1. **資料結構變更**
   - ERP 先修改表格結構
   - 執行 Migration 到共享資料庫
   - Online 更新讀取邏輯

2. **新功能開發**
   - 確認資料來源（ERP 還是 Online 資料庫）
   - 需要 ERP 資料時使用 `getErpSupabase()`
   - 需要寫入時只能用 `getOnlineSupabase()`

3. **命名一致性**
   - 保持與 ERP 相同的表格/欄位命名
   - 前端呈現可以使用中文（如「我的行程」）

### 開發時自問

- [ ] 這個資料從哪個資料庫來？
- [ ] 需要寫入嗎？（只有 Online 資料庫可寫）
- [ ] 有用 `dedup()` 包裝 fetch 嗎？
- [ ] 多個查詢有用 `Promise.all` 平行執行嗎？

---

## 給 AI 助手的重要提醒

1. **理解 Online 定位**
   - Online 是會員的體驗入口
   - 資料主要來自 ERP，但 Online 可以產生自己的資料（照片、回憶等）

2. **雙資料庫規則**
   - ERP 資料庫只能讀，不能寫
   - 需要寫入的功能只能用 Online 資料庫

3. **效能優先**
   - 這是手機 App，效能極度重要
   - 必須使用單例、去重、快取等優化

4. **離線考量**
   - 旅途中可能沒網路
   - 考慮離線快取策略

5. **ERP 是上游**
   - 資料結構以 ERP 為主
   - Online 配合 ERP 的資料模型

---

## 相關文件

| 文件 | 位置 | 說明 |
|-----|------|------|
| SITEMAP.md | `/Users/williamchien/Projects/SITEMAP.md` | 完整系統地圖 |
| CLAUDE.md | `.claude/CLAUDE.md` | Claude 工作規範 |
| venturo-erp | `/Users/williamchien/Projects/venturo-erp` | ERP 專案目錄 |
| ERP VISION | `venturo-erp/.claude/VENTURO_VISION.md` | ERP 端願景文件 |

---

**這份文件定義了 Venturo 的核心願景。在開發任何功能前，請確保你理解這個雙平台架構的全貌，以及 Online 在生態系統中的角色。**
